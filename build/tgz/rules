#!/usr/bin/make -f

TARGET=$(NAME)-$(VERSION)

build:
	touch build-stamp-tgz
	test -n "${SUDO_USER}" && chown "${SUDO_USER}" build-stamp-tgz

clean:
	-rm -f build
	-rm -rf tgz/tmp

binary:	binary-indep binary-arch

binary-indep:	checkroot build
	@rm -rf tgz/tmp
	#Create the directories:
	install -d tgz/tmp
	install -d tgz/tmp/$(TARGET)
	install -d tgz/tmp/$(TARGET)/admin
	install -d tgz/tmp/$(TARGET)/doc
	install -d tgz/tmp/$(TARGET)/etc
	install -d tgz/tmp/$(TARGET)/examples
	install -d tgz/tmp/$(TARGET)/init.d
	install -d tgz/tmp/$(TARGET)/man
	install -d tgz/tmp/$(TARGET)/man/man1
	install -d tgz/tmp/$(TARGET)/man/man5

	#Install the scripts and the config:
	install -m 755 ../sanewall tgz/tmp/$(TARGET)/
	install -m 755 ../admin/*.sh tgz/tmp/$(TARGET)/
	install -m 755 ../init.d/* tgz/tmp/$(TARGET)/init.d
	install -m 644 ../etc/RESERVED_IPS tgz/tmp/$(TARGET)/etc

	#Copy the documentation:
	install -m 644 ../doc/*.html ../doc/*.css tgz/tmp/$(TARGET)/doc/
	install -m 644 ../man/man1/*.1 tgz/tmp/$(TARGET)/man/man1/
	install -m 644 ../man/man5/*.5 tgz/tmp/$(TARGET)/man/man5/

	#Copy the examples:
	install -m 644 ../examples/*.conf tgz/tmp/$(TARGET)/examples/

	#Copyright, Changelog, etc:
	install -m 644 ../ChangeLog tgz/tmp/$(TARGET)/
	gzip -9 tgz/tmp/$(TARGET)/ChangeLog
	install -m 644 ../README tgz/tmp/$(TARGET)/
	install -m 644 ../INSTALL tgz/tmp/$(TARGET)/
	install -m 644 ../COPYING tgz/tmp/$(TARGET)/

	tar zcpCf tgz/tmp $(TARGET).tar.gz $(TARGET)
	rm -rf tgz/tmp
	test -n "${SUDO_USER}" && chown "${SUDO_USER}" $(TARGET).tar.gz

binary-arch:	checkroot build
	# No architecture dependent packages

checkroot:
	test root = "`whoami`"

.PHONY: binary clean binary-indep binary-arch build install clean
